<div class="dashboard-layout flex flex-col h-screen">
  <!-- Header -->
  <app-header (sidebarToggle)="toggleSidebar()"></app-header>

  <!-- Contenedor principal -->
  <div class="main-container flex flex-grow">
    <!-- Sidebar -->
    <app-siderbang *ngIf="isSidebarVisible" class="siderbang w-64"></app-siderbang>

    <div class="container mx-auto p-4">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-3xl font-semibold">Roles del Sistema</h2>

        <div class="flex space-x-4">
          <!-- Botón para regresar a Usuarios -->
          <button (click)="goToUsers()" 
                  class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
            🔙 Regresar a Usuarios
          </button>

          <!-- Botón para agregar un nuevo rol -->
          <button (click)="openCreateRoleModal()" 
                  class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
            ➕ Crear Nuevo Rol
          </button>
          <button (click)="goToPermissions()" 
          class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
            🔒 Ver Permisos
          </button>
        </div>
      </div>

      <!-- Tabla de Roles -->
      <div class="overflow-x-auto shadow-lg rounded-lg">
        <table class="min-w-full bg-white border border-gray-200">
          <thead>
            <tr>
              <th class="px-6 py-3 text-left font-medium">Nombre del Rol</th>
              <th class="px-6 py-3 text-left font-medium">Descripción</th>
              <th class="px-6 py-3 text-left font-medium">Permisos Asociados</th>
              <th class="px-6 py-3 text-left font-medium">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let role of roles">
              <td class="px-6 py-4">{{ role.role_name }}</td>
              <td class="px-6 py-4">{{ role.description }}</td>
              <td class="px-6 py-4">
                <div *ngFor="let permission of role.permissions">
                  <span class="inline-block bg-blue-100 px-2 py-1 rounded text-sm">
                    {{ permission.permission_name || 'Sin permisos' }}
                  </span>
                </div>
              </td>
              
              <td class="px-6 py-4 flex space-x-2">
                <button (click)="openDetailRoleModal(role)" class="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600">👁 Ver</button>
                <button (click)="openEditRoleModal(role)" class="bg-yellow-500 text-white px-3 py-1 rounded-lg hover:bg-yellow-600">
                  ✏️ Editar
                </button>
                <button (click)="openDeleteRoleModal(role)" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600">
                  🗑 Eliminar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal para agregar nuevo rol -->
<div *ngIf="isCreateRoleModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h3 class="text-xl font-semibold mb-4">Crear Nuevo Rol</h3>

    <label class="block mb-2">Nombre del Rol</label>
    <input [(ngModel)]="newRole.roleName" class="w-full p-2 border rounded mb-4" placeholder="Ej. ROLE_ADMIN"/>

    <label class="block mb-2">Descripción</label>
    <input [(ngModel)]="newRole.description" class="w-full p-2 border rounded mb-4" placeholder="Ej. Administrador con acceso completo"/>

    <div class="flex justify-end space-x-2">
      <button (click)="closeCreateRoleModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
        ❌ Cancelar
      </button>
      <button (click)="createRole()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
        ✅ Crear
      </button>
    </div>
  </div>
</div>

<!-- Modal de carga -->
<div *ngIf="isLoadingModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
    <h3 class="text-xl font-semibold mb-4">Cargando...</h3>
    <div class="spinner"></div> <!-- Puedes agregar un spinner aquí -->
  </div>
</div>

<!-- Modal de éxito -->
<div *ngIf="isSuccessModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
    <h3 class="text-xl font-semibold mb-4 text-green-500">¡Éxito!</h3>
    <p>El rol ha sido creado exitosamente.</p>
  </div>
</div>

<!-- Modal de error -->
<div *ngIf="isErrorModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
    <h3 class="text-xl font-semibold mb-4 text-red-500">Error</h3>
    <p>Hubo un error al crear el rol. Por favor, intenta nuevamente.</p>
  </div>
</div>

<!-- Modal de Detalles del Rol -->
<div *ngIf="isDetailRoleModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h3 class="text-xl font-semibold mb-4">Detalles del Rol</h3>

    <div class="mb-4">
      <label class="font-medium">Nombre del Rol:</label>
      <p class="p-2 border rounded bg-gray-100">{{ selectedRole?.role_name }}</p>
    </div>

    <div class="mb-4">
      <label class="font-medium">Descripción:</label>
      <p class="p-2 border rounded bg-gray-100">{{ selectedRole?.description }}</p>
    </div>

    <div class="mb-4">
      <label class="font-medium">Permisos Asociados:</label>
      <div *ngIf="selectedRole?.permissions.length > 0; else noPermissions">
        <div *ngFor="let permission of selectedRole.permissions">
          <span class="inline-block bg-blue-100 px-2 py-1 rounded text-sm">
            {{ permission.permission_name }}
          </span>
        </div>
      </div>
      <ng-template #noPermissions>
        <p class="text-gray-500">Sin permisos asignados</p>
      </ng-template>
    </div>

    <div class="flex justify-end">
      <button (click)="closeDetailRoleModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
        ❌ Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Modal de Confirmación de Eliminación -->
<div *ngIf="isDeleteRoleModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h3 class="text-xl font-semibold mb-4 text-red-600">⚠️ Confirmar Eliminación</h3>
    <p>¿Estás seguro de que deseas eliminar el rol <strong>{{ selectedRole?.role_name }}</strong>?</p>

    <div class="flex justify-end space-x-2 mt-4">
      <button (click)="closeDeleteRoleModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
        ❌ Cancelar
      </button>
      <button (click)="deleteRole(selectedRole.id)" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
        🗑 Eliminar
      </button>
    </div>
  </div>
</div>

<!-- Modal para editar rol -->
<div *ngIf="isEditRoleModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h3 class="text-xl font-semibold mb-4">Editar Rol</h3>

    <label class="block mb-2">Nombre del Rol</label>
    <input [(ngModel)]="editedRole.role_name" class="w-full p-2 border rounded mb-4" placeholder="Ej. ROLE_ADMIN"/>

    <label class="block mb-2">Descripción</label>
    <input [(ngModel)]="editedRole.description" class="w-full p-2 border rounded mb-4" placeholder="Ej. Administrador con acceso completo"/>

    <label class="block mb-2">Permisos</label>
    <div class="mb-4">
      <div *ngFor="let permission of availablePermissions">
        <input type="checkbox" [(ngModel)]="editedRole.permissions" [value]="permission.id" />
        <label class="ml-2">{{ permission.permission_name }}</label>
      </div>
    </div>

    <div class="flex justify-end space-x-2">
      <button (click)="closeEditRoleModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
        ❌ Cancelar
      </button>
      <button (click)="updateRole()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
        ✅ Actualizar
      </button>
    </div>
  </div>
</div>